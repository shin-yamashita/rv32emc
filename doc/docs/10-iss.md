
# 命令セットシミュレータ

RTL 実装を行う前に、命令セットシミュレータ(ISS)を開発し、ハードウェアのリファレンスに用いた。  
CPU コア開発の流れは以下のようになる。  

1. CPUのハード構成を設計し、パイプラインまで正確にエミュレートした ISS をＣ言語で作成  
   → ISS でテストプログラムを実行  
  risc-v のクロス gdb でのテストプログラム実行結果(実行トレース)をリファレンスとして ISS をデバッグ  
2. 作成した ISS をリファレンスとして HDL(SystemVerilog) を記述、ISS の実行トレースと HDL の論理シミュレーション(xsim) 結果をつき合わせてHDLをデバッグ  
   ISS の実行トレースと突き合わせしやすい形のトレースを HDL の $display で出力しバグの追跡を行った   
   また、ISS 用に作成した命令のテーブルを使用して HDL の命令テーブルを自動生成するようにして記述ミスなどを防いだ  
3. テストプログラムで正しい実行結果が得られるようになったところで、割り込み機構を実装  
   uart でターミナルを接続、タイマー(mtime) でタイマー割り込みができるようにして、Vivado で論理合成を行いFPGAにロード、実機でターミナルをつないで動作確認  
4. モニタープログラムを組んで、テストプログラムをロード、実行できるようにして更に長時間の動作検証を行う  

## 開発した ISS (rvsim)  




